<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="css/principal.css" />
	<!-- Font Awesome -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />

	<link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.css" rel="stylesheet" />


	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.js"></script>
	<script src="https://kit.fontawesome.com/23f63af3b1.js" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<title>Pagina Principal</title>
</head>

<style>
	#btn img {
		width: 225px;
		padding: 12px;
		background-color: rgba(255, 255, 255, 0.857);
	}

	#btn {
		display: flex;
		font-size: 24px;
		list-style: none;
		border-style: solid;
		background-color: white;
		border-color: rgba(212, 212, 212, 0.495);
	}

	#btn li a {
		font-family: 'Courier New', Courier, monospace;
		text-align: center;
		color: black;
		text-decoration: none;
		padding: 29px;
		display: block;
		background-color: rgba(255, 255, 255, 0.857);
		margin: auto;
	}

	#btn li ul {
		position: absolute;
		display: none;
		transform: translateX(-17%) translateY(1%);
		list-style: none;
		font-size: 15px;

	}

	#btn li ul li a {
		justify-content: center;

	}

	#btn li:hover>ul {
		display: block;
	}

	/*principal*/

	.hero {
		background-image: url("../resources/bg-main.jpg");
		background-repeat: no-repeat;
		background-size: cover;
		background-position: bottom center;
		height: 100vh;
		color: #fff;
		display: flex;
		justify-content: center;
		align-items: center;
		text-align: center;
		position: relative;
		margin-bottom: 20px;
		z-index: -2;
	}

	.hero::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.5);
		z-index: -1;
	}

	.hero h1 {
		font-size: 46px;
		margin: -20px 0 20px;
	}

	.hero p {
		font-size: 20px;
		letter-spacing: 1px;
	}

	.content h2,
	.content h3 {
		font-size: 150%;
		margin: 20px 0;
	}

	.content p {
		color: #555;
		line-height: 30px;
		letter-spacing: 1.2px;
	}
</style>

<body>
	<div th:replace="~{nav :: cabecera}"></div>


	<div class="container">
		<form id="form" th:action="@{grabarPrestamista}" method="POST">


			<div class="row">
				<div class="form-group has-feedback col-md-12">
					<br>
					<input type="hidden" id="idCodigo" class="form-control" name="id" value="0">
				</div>

				<div class="row mb-4">
					<div class="col">
						<div>
							<label class="form-label" for=""><strong> DNI</strong></label>
							<input type="text" class="form-control" name="dni" id="dni" maxlength="8" minlength="8" pattern="[0-9]{8}" title="EL FORMATO ES INCORRECTO, solo acepta 8 números"/>
						</div>
					</div>
					<div class="col">
						<div>
							<label class="form-label" for=""><strong> Nombre</strong></label>
							<input type="text" id="" class="form-control" name="nombre" />
						</div>
					</div>
					<div class="col">
						<div>
							<label class="form-label" for=""><strong>Apellido</strong></label>
							<input type="textbox" id="" class="form-control" name="apellido" />
						</div>
					</div>
					<div class="col">
						<div>
							<label class="form-label" for=""><strong>Nombre de Usuario</strong></label>
							<input type="textbox" id="" class="form-control" name="username" />
						</div>
					</div>
				</div>

				<div class="row mb-4">
					<div class="col">
						<div>
							<label class="form-label" for=""><strong>Email</strong></label>
							<br>
							<input type="email" id="" class="form-control" name="email" />
						</div>
					</div>
					<div class="col">
						<div>
							<label class="form-label" for=""><strong>Telefono</strong></label>
							<input type="textbox" id="" class="form-control" name="telefono" maxlength="9" minlength="9" pattern="[0-9]{9}" title="EL FORMATO ES INCORRECTO, solo acepta 9 números"/>
						</div>
					</div>
					<div class="col">
						<div>
							<label class="form-label" for=""><strong>Contraseña</strong></label>
							<input type="password" id="" class="form-control" name="password" />
						</div>
					</div>

					<div class="col">
						<br>
						<label for="sector">Sector:</label>
						<select id="sector" name="sector" required>

							<option th:each="sector : ${sectores}" th:text="${sector.nombre}" th:value="${sector.id}">
							</option>
						</select>
					</div>

				</div>



				<br>
				<br>
				<div class="text-center">
					<input type="submit" class="btn btn-primary" value="Registrar" />
					<a href="./solicitudes-main.html" class="btn btn-danger">CANCELAR</a>

					<br>
					<br>
					<br>
					<br>
				</div>

		</form>

	</div>


	<footer class="text-center text-lg-start bg-body-tertiary text-muted">

		<section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
			<div class="me-5 d-none d-lg-block">

			</div>
			<div>
				<a href="" class="me-4 text-reset">
					<i class="fab fa-facebook-f"></i>
				</a>
				<a href="" class="me-4 text-reset">
					<i class="fab fa-twitter"></i>
				</a>
				<a href="" class="me-4 text-reset">
					<i class="fab fa-google"></i>
				</a>
				<a href="" class="me-4 text-reset">
					<i class="fab fa-instagram"></i>
				</a>
				<a href="" class="me-4 text-reset">
					<i class="fab fa-linkedin"></i>
				</a>
				<a href="" class="me-4 text-reset">
					<i class="fab fa-github"></i>
				</a>
			</div>

		</section>

		<div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
			© 2024 Copyright:
			<a class="text-reset fw-bold" href="https://mdbootstrap.com/">PROYECTO EFSRT</a>
		</div>
		<!-- Copyright -->
	</footer>
	</section>
	<script>
		const nav = document.querySelector('.nav')
		window.addEventListener('scroll', fixNav)

		function fixNav() {
			if (window.scrollY > nav.offsetHeight + 150) {
				nav.classList.add('active')
			} else {
				nav.classList.remove('active')
			}
		}
	</script>
</body>

<script>
$(document).ready(function() {
    $('#logoutButton').submit(function(event) {
        event.preventDefault(); // Evita que se envíe el formulario de forma predeterminada
        
        // Realiza la solicitud AJAX al controlador Spring para cerrar sesión
        $.ajax({
            type: 'POST', // o 'GET' dependiendo de cómo esté implementado el cierre de sesión en tu servidor
            url: '/logout', // URL que maneja el cierre de sesión
            success: function(response) {
                // Si la respuesta es exitosa, redirige al usuario a la página de inicio, o realiza cualquier otra acción necesaria
                window.location.href = "/sesion/login"; // Redirige al usuario a la página de inicio
            },
            error: function(xhr, status, error) {
                // Maneja cualquier error de manera adecuada
                console.error('Error al cerrar sesión:', error);
            }
        });
    });

    $('#form').submit(function(event) {
        event.preventDefault(); // Evita que se envíe el formulario de forma predeterminada
        
        // Realiza la solicitud AJAX al controlador Spring
        $.ajax({
			type: 'POST',
			            url: $(this).attr('action'),
			            data: $(this).serialize(), // Serializa los datos del formulario
			            success: function(response) {
			                // Si la respuesta es exitosa, redirige o realiza cualquier otra acción necesaria
			                alert(response); // Muestra un mensaje de éxito
			            },
            error: function(xhr, status, error) {
                // Si hay un error en la solicitud AJAX
                if (xhr.status === 400) {
                    // Si el usuario ya está registrado, muestra una alerta
                    var responseData = JSON.parse(xhr.responseText); // Parsea la respuesta JSON
                    alert(responseData.message); // Muestra el mensaje de error proporcionado por el servidor
                } else {
                    // Maneja otros errores de manera adecuada
                }
            }
        });
    });
});
</script>

</html>